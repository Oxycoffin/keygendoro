<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <!-- Meta etiqueta de viewport para responsividad -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomodoro Timer</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #00ccff;
            --secondary-color: #66ffff;
            --background-gradient-from: #0d0d0d;
            --background-gradient-to: #121212;
            --button-gradient-angle: 45deg;
            --glare-color: rgba(0, 204, 255, 0.5);
            --cursor-color: rgba(0, 204, 255, 0.7);
            --button-text-color: #ffffff;
            --font-family: 'Press Start 2P', cursive;
            --transition-speed: 0.3s;
        }

        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: var(--font-family);
            transition: all var(--transition-speed) ease;
        }

        body {
            background: radial-gradient(circle at center, var(--background-gradient-from), var(--background-gradient-to)),
                        url('https://www.transparenttextures.com/patterns/dark-mosaic.png');
            background-size: cover;
            background-position: center;
            color: var(--primary-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            position: relative;
            cursor: none;
            animation: backgroundPulse 20s infinite alternate;
        }

        @keyframes backgroundPulse {
            from { background-color: var(--background-gradient-from); }
            to { background-color: var(--background-gradient-to); }
        }

        .pomodoro-container {
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            padding: 1rem;
            width: 90%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            animation: slideIn 1s ease-out;
            box-shadow: 0 0 4px var(--primary-color);
            background-image: url('https://www.transparenttextures.com/patterns/small-dots.png');
            background-size: cover;
            transition: border-color 0.5s, box-shadow 0.5s, background 0.5s;
            max-height: 95vh;
            /* Removed overflow: hidden to allow .scrollable-content to scroll properly */
        }

        /* Sección Fija */
        .fixed-header {
            width: 100%;
            padding: 1rem 0;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        /* Botón de Música Integrado en la Sección Fija */
        .music-control {
            position: absolute;
            top: 20px; 
            right: 20px; 
            background: linear-gradient(var(--button-gradient-angle), var(--primary-color), var(--secondary-color));
            border: none;
            border-radius: 50%;
            width: 25px; 
            height: 25px; 
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: background 0.5s, transform 0.3s, border-color 0.5s, box-shadow 0.5s;
            box-shadow: 0 0 2px var(--primary-color), 0 0 5px var(--primary-color);
        }

        .music-control:hover {
            background: linear-gradient(var(--button-gradient-angle), var(--secondary-color), var(--primary-color));
            transform: scale(1.1);
            box-shadow: 0 0 3px var(--secondary-color), 0 0 6px var(--secondary-color);
        }

        .music-control img {
            width: 14px; 
            height: 14px; 
            filter: brightness(0) invert(1);
            transition: transform 0.3s;
        }

        /* Sección Desplazable */
        .scrollable-content {
            width: 100%;
            overflow-y: auto;
            flex: 1;
            padding: 0.5rem;
            background: rgba(0, 0, 0, 0.85);
            transition: box-shadow 0.5s;
            margin-top: 0rem;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header, h2, .timer-display, .session-counter, .task-section h3, .footer, .session-indicator {
            text-align: center;
            color: var(--primary-color);
            text-shadow: 0 0 2px var(--glare-color), 0 0 5px var(--glare-color);
            animation: glowText 2s infinite alternate;
        }

        .session-indicator {
            font-size: 1rem;
            margin-top: 0.5rem;
            color: var(--secondary-color);
            text-shadow: 0 0 2px var(--glare-color), 0 0 5px var(--glare-color);
        }

        @keyframes glowText {
            from { text-shadow: 0 0 2px var(--glare-color), 0 0 5px var(--glare-color); }
            to { text-shadow: 0 0 5px var(--secondary-color), 0 0 10px var(--secondary-color); }
        }

        h2 {
            font-size: 1.2rem;
            margin: 0.6rem 0;
            color: var(--secondary-color);
            animation: flicker 3s infinite;
        }

        @keyframes flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        label, .task-section h3 {
            font-size: 0.8rem;
            color: var(--primary-color);
            text-shadow: 0.5px 0.5px 1px #000;
        }

        select, input[type="number"], .add-task input {
            width: 100%;
            padding: 0.5rem;
            margin-bottom: 0.8rem;
            border: 2px solid var(--primary-color);
            border-radius: 4px;
            background: #1e1e1e;
            color: #ffffff;
            font-size: 0.8rem;
            appearance: none;
            cursor: pointer;
            box-shadow: inset 0 0 2px var(--primary-color);
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        select::-ms-expand {
            display: none;
        }

        select {
            background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" width="10" height="5"><polygon points="0,0 10,0 5,5" fill="%23ffffff"/></svg>');
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 10px 5px;
        }

        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type="number"] {
            -moz-appearance: textfield;
        }

        input[type="number"]:focus, select:focus, .add-task input:focus {
            border-color: var(--secondary-color);
            box-shadow: inset 0 0 3px var(--secondary-color);
            outline: none;
        }

        .controls, .additional-controls {
            display: flex;
            gap: 0.6rem;
            margin-top: 0.8rem;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
        }

        .additional-controls {
            margin-top: 1rem;
        }

        button.control-btn, .add-task button, button.skip-btn {
            padding: 0.5rem 1rem;
            background: linear-gradient(var(--button-gradient-angle), var(--primary-color), var(--secondary-color));
            border: none;
            border-radius: 4px;
            color: var(--button-text-color);
            font-size: 0.8rem;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.5s, background 0.5s;
            box-shadow: 0 0 2px var(--primary-color), 0 0 5px var(--primary-color);
            position: relative;
            overflow: hidden;
        }

        button.control-btn::before, .add-task button::before, button.skip-btn::before {
            content: '';
            position: absolute;
            top: -25%; 
            left: -25%; 
            width: 150%; 
            height: 150%; 
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(45deg);
            transition: all 0.5s;
        }

        button.control-btn:hover::before, .add-task button:hover::before, button.skip-btn:hover::before {
            top: 0;
            left: 0;
        }

        button.control-btn:hover, .add-task button:hover, button.skip-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 3px var(--secondary-color), 0 0 6px var(--secondary-color);
        }

        button.control-btn:active, .add-task button:active, button.skip-btn:active {
            transform: scale(0.98);
            box-shadow: 0 0 2px var(--primary-color), 0 0 4px var(--primary-color);
        }

        .timer-display {
            font-size: 2rem;
            margin-top: 1rem;
            color: var(--secondary-color);
            text-shadow: 0 0 1px var(--glare-color), 0 0 3px var(--glare-color);
            animation: flicker 3s infinite;
        }

        .progress-container {
            width: 100%;
            height: 1.5rem;
            background: rgba(51, 51, 51, 0.7);
            border-radius: 6px;
            overflow: hidden;
            margin-top: 0.8rem;
            box-shadow: inset 0 0 4px var(--primary-color);
            transition: box-shadow 0.5s;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transition: width 0.3s;
            z-index: 1;
        }

        .progress-percentage {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.8rem;
            color: #ffffff;
            text-shadow: 0.5px 0.5px 1px #000;
            z-index: 2;
        }

        .session-counter, .footer {
            font-size: 0.8rem;
            color: var(--secondary-color);
            text-shadow: 0.5px 0.5px 1px var(--glare-color), 0 0 3px var(--glare-color);
            margin-top: 1rem;
        }

        .footer {
            color: #666666;
            animation: floatFooter 4s infinite;
        }

        @keyframes floatFooter {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-2px); }
        }

        .task-section h3 {
            font-size: 0.8rem;
            margin-bottom: 0.2rem;
        }

        .task-list {
            list-style: none;
            width: 100%;
            background: #1e1e1e;
            border: 1px solid var(--primary-color);
            border-radius: 4px;
            padding: 0.5rem;
            box-shadow: inset 0 0 4px var(--primary-color);
            transition: border-color 0.3s, box-shadow 0.3s;
            cursor: pointer;
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .task-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            border-bottom: 1px solid #333;
            color: #ffffff;
            font-size: 0.8rem;
        }

        .task-list li:last-child {
            border-bottom: none;
        }

        .task-list li.completed {
            text-decoration: line-through;
            text-decoration-thickness: 2px;
            color: var(--secondary-color);
        }

        .task-list button {
            background: none;
            border: none;
            color: var(--button-text-color);
            cursor: pointer;
            font-size: 0.8rem;
            margin-left: 0.5rem;
        }

        .task-list button:hover {
            color: var(--secondary-color);
        }

        #customCursor {
            position: fixed;
            top: 0;
            left: 0;
            width: 12px;
            height: 12px;
            background-color: var(--cursor-color);
            border: 2px solid var(--primary-color);
            border-radius: 50%;
            pointer-events: none;
            transform: translate(-50%, -50%);
            animation: pulse 2s infinite;
            z-index: 1000;
            transition: transform 0.2s, background-color 0.5s, border-color 0.5s;
        }

        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            50% { transform: translate(-50%, -50%) scale(1.3); opacity: 0.6; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        /* Media Queries Mejoradas para Pantallas Grandes */
        @media (min-width: 1024px) {
            .pomodoro-container {
                padding: 1rem;
                max-width: 600px;
            }

            h2 {
                font-size: 1.5rem;
            }

            label, .task-section h3 {
                font-size: 0.9rem;
            }

            select, input[type="number"], .add-task input {
                font-size: 0.9rem;
                padding: 0.6rem;
            }

            button.control-btn, .add-task button, button.skip-btn {
                font-size: 0.9rem;
                padding: 0.6rem 1.2rem;
            }

            .timer-display {
                font-size: 2.5rem;
            }

            .progress-container {
                height: 2rem;
            }

            .progress-percentage {
                font-size: 1rem;
            }

            .session-counter, .footer {
                font-size: 1rem;
            }

            .task-list li {
                font-size: 0.9rem;
            }

            .music-control {
                width: 25px; 
                height: 25px;
            }

            .music-control img {
                width: 14px; 
                height: 14px;
            }

            #customCursor {
                width: 14px;
                height: 14px;
            }
        }

        /* Media Queries Mejoradas para Pantallas Medianas */
        @media (min-width: 768px) and (max-width: 1023px) {
            .pomodoro-container {
                padding: 1rem;
                max-width: 550px;
            }

            h2 {
                font-size: 1.3rem;
            }

            label, .task-section h3 {
                font-size: 0.85rem;
            }

            select, input[type="number"], .add-task input {
                font-size: 0.85rem;
                padding: 0.5rem;
            }

            button.control-btn, .add-task button, button.skip-btn {
                font-size: 0.85rem;
                padding: 0.5rem 1rem;
            }

            .timer-display {
                font-size: 2.2rem;
            }

            .progress-container {
                height: 1.8rem;
            }

            .progress-percentage {
                font-size: 0.9rem;
            }

            .session-counter, .footer {
                font-size: 0.9rem;
            }

            .task-list li {
                font-size: 0.85rem;
            }

            .music-control {
                width: 25px;
                height: 25px;
            }

            .music-control img {
                width: 14px;
                height: 14px;
            }

            #customCursor {
                width: 12px;
                height: 12px;
            }
        }

        /* Media Queries para Pantallas Pequeñas y Móviles */
        @media (max-width: 767px) {
            .pomodoro-container {
                padding: 1rem;
                max-width: 90%;
            }

            h2 {
                font-size: 1.2rem;
            }

            label, .task-section h3 {
                font-size: 0.8rem;
            }

            select, input[type="number"], .add-task input {
                font-size: 0.8rem;
                padding: 0.5rem;
            }

            button.control-btn, .add-task button, button.skip-btn {
                font-size: 0.8rem;
                padding: 0.5rem 1rem;
            }

            .timer-display {
                font-size: 2rem;
            }

            .progress-container {
                height: 1.5rem;
            }

            .progress-percentage {
                font-size: 0.8rem;
            }

            .session-counter, .footer {
                font-size: 0.8rem;
            }

            .task-list li {
                font-size: 0.8rem;
            }

            .music-control {
                width: 25px;
                height: 25px;
            }

            .music-control img {
                width: 14px;
                height: 14px;
            }

            #customCursor {
                width: 10px;
                height: 10px;
            }
        }

        /* Ocultar el cursor personalizado en dispositivos táctiles */
        @media (hover: none) and (pointer: coarse) {
            #customCursor {
                display: none;
            }
        }

        /* Estilos para la sección desplegable (Acordeón) */
        .dropdown {
            width: 100%;
            margin-top: 0.5rem; 
            margin-bottom: 1rem;
        }

        .dropdown button {
            width: 100%;
            padding: 0.5rem;
            background: linear-gradient(var(--button-gradient-angle), var(--primary-color), var(--secondary-color));
            border: none;
            border-radius: 4px;
            color: var(--button-text-color);
            font-size: 0.8rem;
            cursor: pointer;
            text-align: left;
            position: relative;
            transition: background 0.3s;
            box-shadow: 0 0 2px var(--primary-color), 0 0 5px var(--primary-color);
        }

        .dropdown button::after {
            content: '\25BC'; 
            position: absolute;
            right: 1rem;
            transition: transform 0.3s;
        }

        .dropdown button.active::after {
            transform: rotate(180deg);
        }

        .dropdown-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            width: 100%;
        }

        .dropdown-content.open {
            max-height: 500px; 
        }

        .dropdown-content .task-section {
            padding: 0.5rem 0;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            margin-top: 0.5rem;
        }

        .auto-start-checkbox {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }

        .checkbox-container label {
            position: relative;
            padding-left: 25px;
            cursor: pointer;
            font-size: 0.8rem;
            user-select: none;
            color: var(--primary-color);
        }

        .checkbox-container label::before {
            content: "";
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            height: 18px;
            width: 18px;
            background-color: #1e1e1e;
            border: 2px solid var(--primary-color);
            border-radius: 4px;
            transition: background-color 0.3s, border-color 0.3s;
        }

        .auto-start-checkbox:checked + label::before {
            background-color: var(--primary-color);
            border-color: var(--secondary-color);
        }

        .checkbox-container label::after {
            content: "";
            position: absolute;
            left: 5px;
            top: 50%;
            transform: translateY(-50%) rotate(45deg);
            width: 5px;
            height: 10px;
            border: solid #ffffff;
            border-width: 0 2px 2px 0;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .auto-start-checkbox:checked + label::after {
            opacity: 1;
        }

        .task-section .add-task {
            display: flex;
            align-items: center;
            gap: 0.5rem; 
            margin-top: 0.5rem; 
        }

        .task-section .add-task input {
            flex: 1;
            padding: 0.5rem; 
        }

        .task-section .add-task button {
            margin-top: -0.8rem; 
            flex: 0 0 auto;
            padding: 0.5rem 1rem;
        }

        .duration-input {
            display: flex;
            flex-direction: column;
            margin-bottom: 0.8rem;
        }

        .duration-input label {
            margin-bottom: 0.3rem;
            font-size: 0.9rem;
            color: var(--primary-color);
        }

        .duration-input input {
            width: 100%;
            padding: 0.5rem;
            border: 2px solid var(--primary-color);
            border-radius: 4px;
            background: #1e1e1e;
            color: #ffffff;
            font-size: 0.9rem;
            box-shadow: inset 0 0 2px var(--primary-color);
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .duration-input input:focus {
            border-color: var(--secondary-color);
            box-shadow: inset 0 0 3px var(--secondary-color);
            outline: none;
        }
    </style>
</head>
<body>
    <div id="customCursor"></div>
    <div class="pomodoro-container">
        <!-- Botón de Música (Mute/Unmute) -->
        <div class="music-control interactive" id="musicControl">
            <img src="https://img.icons8.com/ios-filled/50/ffffff/mute.png" alt="Mute/Unmute" id="musicIcon">
        </div>

        <!-- Sección Fija -->
        <div class="fixed-header">
            <!-- Logo -->
            <div class="header">
                <pre style="font-family: 'Courier New', monospace; white-space: pre; line-height: 1; font-size: 10px;">
██████╗  ██████╗ ███╗   ███╗ ██████╗ ██████╗  ██████╗ ██████╗  ██████╗
██╔══██╗██╔═══██╗████╗ ████║██╔═══██╗██╔══██╗██╔═══██╗██╔══██╗██╔═══██╗
██████╔╝██║   ██║██╔████╔██║██║   ██║██║  ██║██║   ██║██████╔╝██║   ██║
██╔═══╝ ██║   ██║██║╚██╔╝██║██║   ██║██║  ██║██║   ██║██╔══██╗██║   ██║
██║     ╚██████╔╝██║ ╚═╝ ██║╚██████╔╝██████╔╝╚██████╔╝██║  ██║╚██████╔╝
╚═╝      ╚═════╝ ╚═╝     ╚═╝ ╚═════╝ ╚═════╝  ╚═════╝ ╚═╝  ╚═╝ ╚═════╝
                </pre>
            </div>

            <!-- Timer Display -->
            <div class="timer-display" id="timerDisplay">25:00</div>

            <!-- Indicador de Tipo de Sesión -->
            <div class="session-indicator" id="sessionIndicator">Tipo de Sesión: Trabajo</div>

            <!-- Barra de Progreso Siempre Visible -->
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar" id="progressBar"></div>
                <div class="progress-percentage" id="progressPercentage">0%</div>
            </div>

            <!-- Contador de Sesiones Completadas -->
            <div class="session-counter" id="sessionCounter">Sesiones completadas: 0</div>

            <!-- Botones de Control (Iniciar, Saltar, Reiniciar) -->
            <div class="controls">
                <button class="control-btn interactive" id="startPauseBtn">Iniciar</button>
                <button class="control-btn interactive" id="skipBtn">Saltar</button>
                <button class="control-btn interactive" id="resetBtn">Reiniciar</button>
            </div>

            <!-- Checkbox para Auto Iniciar la Siguiente Sesión -->
            <div class="checkbox-container">
                <input type="checkbox" id="autoStartCheckbox" class="auto-start-checkbox">
                <label for="autoStartCheckbox">Auto Iniciar Siguiente Sesión</label>
            </div>
        </div>

        <!-- Sección Desplazable -->
        <div class="scrollable-content">
            <!-- Sección Desplegable para Personalizar Duraciones -->
            <div class="dropdown">
                <button id="toggleDurationsBtn">Personalizar Duraciones</button>
                <div class="dropdown-content" id="dropdownContent">
                    <div class="task-section">
                        <div class="duration-input">
                            <label for="workDuration">Trabajo (minutos):</label>
                            <input type="number" id="workDuration" min="1" value="25" class="interactive">
                        </div>
                        <div class="duration-input">
                            <label for="shortBreakDuration">Descanso Corto (minutos):</label>
                            <input type="number" id="shortBreakDuration" min="1" value="5" class="interactive">
                        </div>
                        <div class="duration-input">
                            <label for="longBreakDuration">Descanso Largo (minutos):</label>
                            <input type="number" id="longBreakDuration" min="1" value="15" class="interactive">
                        </div>
                        <div class="duration-input">
                            <label for="shortBreaksBeforeLongBreak">Descansos Cortos:</label>
                            <input type="number" id="shortBreaksBeforeLongBreak" min="1" value="4" class="interactive">
                        </div>
                        <button class="control-btn interactive" id="saveDurationsBtn">Guardar</button>
                    </div>
                </div>
            </div>

            <!-- Lista de Tareas -->
            <div class="task-section">
                <h3>Lista de Tareas:</h3>
                <ul class="task-list interactive" id="taskList"></ul>
                <div class="add-task">
                    <input type="text" id="newTaskInput" placeholder="Nueva tarea..." class="interactive">
                    <button class="control-btn interactive" id="addTaskBtn">Añadir</button>
                </div>
            </div>

            <!-- Pie de Página -->
            <div class="footer">2000© no rights reserved</div>
        </div>
    </div>

    <!-- Audio -->
    <audio id="backgroundMusic" loop>
        <source src="midi.mp3" type="audio/mpeg">
        <source src="midi.ogg" type="audio/ogg">
        Tu navegador no soporta la reproducción de audio.
    </audio>
    <audio id="notificationSound">
        <source src="notification.mp3" type="audio/mpeg">
        <source src="notification.ogg" type="audio/ogg">
        Tu navegador no soporta la reproducción de audio.
    </audio>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const elements = {
                startPauseBtn: document.getElementById('startPauseBtn'),
                resetBtn: document.getElementById('resetBtn'),
                skipBtn: document.getElementById('skipBtn'),
                sessionIndicatorText: document.getElementById('sessionIndicator'),
                progressContainer: document.getElementById('progressContainer'),
                progressBar: document.getElementById('progressBar'),
                progressPercentage: document.getElementById('progressPercentage'),
                timerDisplay: document.getElementById('timerDisplay'),
                musicControl: document.getElementById('musicControl'),
                musicIcon: document.getElementById('musicIcon'),
                backgroundMusic: document.getElementById('backgroundMusic'),
                sessionCounter: document.getElementById('sessionCounter'),
                customCursor: document.getElementById('customCursor'),
                saveDurationsBtn: document.getElementById('saveDurationsBtn'),
                workDurationInput: document.getElementById('workDuration'),
                shortBreakDurationInput: document.getElementById('shortBreakDuration'),
                longBreakDurationInput: document.getElementById('longBreakDuration'),
                shortBreaksBeforeLongBreakInput: document.getElementById('shortBreaksBeforeLongBreak'),
                taskList: document.getElementById('taskList'),
                addTaskBtn: document.getElementById('addTaskBtn'),
                newTaskInput: document.getElementById('newTaskInput'),
                notificationSound: document.getElementById('notificationSound'),
                root: document.documentElement,
                toggleDurationsBtn: document.getElementById('toggleDurationsBtn'),
                dropdownContent: document.getElementById('dropdownContent'),
                autoStartCheckbox: document.getElementById('autoStartCheckbox')
            };

            let isMusicMuted = false;
            let timerDuration = 25 * 60;
            let timerRemaining = timerDuration;
            let timerInterval = null;
            let isRunning = false;
            let currentSession = 'work';
            let completedWorkSessions = 0;
            let endTime = null;
            let shortBreaksBeforeLongBreak = parseInt(localStorage.getItem('shortBreaksBeforeLongBreak'), 10) || 4;
            let shortBreaksCompleted = 0;

            const colorPalettes = [
                { primary: '#00ccff', secondary: '#66ffff', gradientFrom: '#0d0d0d', gradientTo: '#121212', gradientAngle: '45deg', cursorColor: 'rgba(0, 204, 255, 0.7)' },
                { primary: '#ff66cc', secondary: '#ff99ee', gradientFrom: '#1a0d0d', gradientTo: '#2c1212', gradientAngle: '60deg', cursorColor: 'rgba(255, 102, 204, 0.7)' },
                { primary: '#66ff66', secondary: '#99ff99', gradientFrom: '#0d1a0d', gradientTo: '#121c12', gradientAngle: '30deg', cursorColor: 'rgba(102, 255, 102, 0.7)' },
                { primary: '#ffcc00', secondary: '#ffe066', gradientFrom: '#1a1a0d', gradientTo: '#2c2c12', gradientAngle: '90deg', cursorColor: 'rgba(255, 204, 0, 0.7)' },
                { primary: '#cc00ff', secondary: '#e066ff', gradientFrom: '#0d0d1a', gradientTo: '#12122c', gradientAngle: '135deg', cursorColor: 'rgba(204, 0, 255, 0.7)' }
            ];

            function selectRandomPalette() {
                return colorPalettes[Math.floor(Math.random() * colorPalettes.length)];
            }

            function updateSessionType() {
                timerDuration = getDurationBySession(currentSession);
                timerRemaining = timerDuration;
                elements.timerDisplay.textContent = formatTime(timerRemaining);
                elements.progressBar.style.width = '0%';
                elements.progressPercentage.textContent = '0%';
                elements.sessionIndicatorText.textContent = `Tipo de Sesión: ${capitalizeFirstLetter(currentSession)}`;
                resetMusic();
                clearTimerState();
            }

            function getDurationBySession(session) {
                const durations = {
                    work: parseInt(elements.workDurationInput.value, 10),
                    shortBreak: parseInt(elements.shortBreakDurationInput.value, 10),
                    longBreak: parseInt(elements.longBreakDurationInput.value, 10)
                };
                return (durations[session] || 25) * 60;
            }

            function formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
            }

            function startTimer(shouldSave = true) {
                if (isRunning) return;
                isRunning = true;
                elements.startPauseBtn.textContent = 'Pausar';

                if (shouldSave) {
                    endTime = Date.now() + timerRemaining * 1000;
                    saveTimerState();
                }

                timerInterval = setInterval(() => {
                    const now = Date.now();
                    timerRemaining = Math.floor((endTime - now) / 1000);

                    if (timerRemaining > 0) {
                        elements.timerDisplay.textContent = formatTime(timerRemaining);
                        updateProgress();
                    } else {
                        clearInterval(timerInterval);
                        isRunning = false;
                        elements.startPauseBtn.textContent = 'Iniciar';
                        elements.timerDisplay.textContent = formatTime(0);
                        elements.progressBar.style.width = '100%';
                        elements.progressPercentage.textContent = '100%';
                        handleSessionEnd();
                    }
                }, 1000);

                if (currentSession === 'work') playMusic();
            }

            function pauseTimer() {
                if (!isRunning) return;
                isRunning = false;
                elements.startPauseBtn.textContent = 'Iniciar';
                clearInterval(timerInterval);
                if (currentSession === 'work') pauseMusic();
                clearTimerState();
                changePalette();
            }

            function resetTimer() {
                clearInterval(timerInterval);
                isRunning = false;
                elements.startPauseBtn.textContent = 'Iniciar';
                timerRemaining = timerDuration;
                elements.timerDisplay.textContent = formatTime(timerRemaining);
                elements.progressBar.style.width = '0%';
                elements.progressPercentage.textContent = '0%';
                if (currentSession === 'work') pauseMusic();
                clearTimerState();
            }

            function skipSession() {
                if (isRunning) {
                    clearInterval(timerInterval);
                    isRunning = false;
                }
                handleSessionEnd(false);
                elements.startPauseBtn.textContent = 'Iniciar'; 
            }

            function handleSessionEnd(shouldAutoStart = true) {
                if (currentSession === 'work') {
                    completedWorkSessions++;
                    elements.sessionCounter.textContent = `Sesiones completadas: ${completedWorkSessions}`;
                    localStorage.setItem('completedWorkSessions', completedWorkSessions);
                }
                elements.notificationSound.play();
                notifyUser(`¡${capitalizeFirstLetter(currentSession)} finalizada!`);
                
                if (currentSession === 'work') {
                    currentSession = 'shortBreak';
                } else if (currentSession === 'shortBreak') {
                    shortBreaksCompleted++;
                    if (shortBreaksCompleted >= shortBreaksBeforeLongBreak) {
                        currentSession = 'longBreak';
                        shortBreaksCompleted = 0;
                    } else {
                        currentSession = 'work';
                    }
                } else if (currentSession === 'longBreak') {
                    currentSession = 'work';
                }
                updateSessionType();

                if (shouldAutoStart && elements.autoStartCheckbox.checked) {
                    startTimer();
                    changePalette();
                }
            }

            function capitalizeFirstLetter(string) {
                return string.charAt(0).toUpperCase() + string.slice(1);
            }

            function notifyUser(message) {
                if (Notification.permission === 'granted') {
                    new Notification(message);
                } else if (Notification.permission !== 'denied') {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'granted') {
                            new Notification(message);
                        }
                    });
                }
            }

            function resetMusic() {
                elements.backgroundMusic.pause();
                elements.backgroundMusic.currentTime = 0;
                if (!isMusicMuted && currentSession === 'work') {
                    elements.musicIcon.src = "https://img.icons8.com/ios-filled/50/ffffff/speaker.png";
                }
            }

            function playMusic() {
                if (!isMusicMuted && currentSession === 'work') {
                    elements.backgroundMusic.play().then(() => {
                        elements.musicIcon.src = "https://img.icons8.com/ios-filled/50/ffffff/speaker.png";
                    }).catch(() => {
                        console.log('No se pudo reproducir la música.');
                    });
                }
            }

            function pauseMusic() {
                elements.backgroundMusic.pause();
                elements.musicIcon.src = "https://img.icons8.com/ios-filled/50/ffffff/mute.png";
            }

            function changePalette() {
                const palette = selectRandomPalette();
                const props = ['--primary-color', '--secondary-color', '--background-gradient-from', '--background-gradient-to', '--button-gradient-angle', '--cursor-color'];
                const values = [palette.primary, palette.secondary, palette.gradientFrom, palette.gradientTo, palette.gradientAngle, palette.cursorColor];
                props.forEach((prop, index) => {
                    elements.root.style.setProperty(prop, values[index]);
                });
                elements.customCursor.style.backgroundColor = palette.cursorColor;
                elements.customCursor.style.borderColor = palette.primary;
            }

            function updateProgress() {
                const progress = ((timerDuration - timerRemaining) / timerDuration) * 100;
                elements.progressBar.style.width = `${progress}%`;
                elements.progressPercentage.textContent = `${Math.floor(progress)}%`;
            }

            function saveTimerState() {
                localStorage.setItem('timerState', JSON.stringify({
                    endTime,
                    currentSession,
                    completedWorkSessions,
                    shortBreaksCompleted
                }));
            }

            function clearTimerState() {
                localStorage.removeItem('timerState');
                endTime = null;
            }

            function saveDurations() {
                const work = parseInt(elements.workDurationInput.value, 10);
                const shortBreak = parseInt(elements.shortBreakDurationInput.value, 10);
                const longBreak = parseInt(elements.longBreakDurationInput.value, 10);
                const shortBreaksBeforeLongBreakVal = parseInt(elements.shortBreaksBeforeLongBreakInput.value, 10);

                if ([work, shortBreak, longBreak, shortBreaksBeforeLongBreakVal].some(d => isNaN(d) || d < 1)) {
                    alert('Por favor, introduce duraciones válidas (minutos) y número válido de descansos cortos.');
                    return;
                }

                localStorage.setItem('workDuration', work);
                localStorage.setItem('shortBreakDuration', shortBreak);
                localStorage.setItem('longBreakDuration', longBreak);
                localStorage.setItem('shortBreaksBeforeLongBreak', shortBreaksBeforeLongBreakVal);
                shortBreaksBeforeLongBreak = shortBreaksBeforeLongBreakVal;

                alert('Duraciones guardadas exitosamente.');
                updateSessionType();
                changePalette();
            }

            function loadDurations() {
                const work = localStorage.getItem('workDuration');
                const shortBreak = localStorage.getItem('shortBreakDuration');
                const longBreak = localStorage.getItem('longBreakDuration');
                const shortBreaksBeforeLongBreakStored = parseInt(localStorage.getItem('shortBreaksBeforeLongBreak'), 10);

                if (work) elements.workDurationInput.value = work;
                if (shortBreak) elements.shortBreakDurationInput.value = shortBreak;
                if (longBreak) elements.longBreakDurationInput.value = longBreak;
                if (shortBreaksBeforeLongBreakStored) {
                    elements.shortBreaksBeforeLongBreakInput.value = shortBreaksBeforeLongBreakStored;
                    shortBreaksBeforeLongBreak = shortBreaksBeforeLongBreakStored;
                }

                updateSessionType();
            }

            function addTask(task = {}) {
                const taskName = task.name || elements.newTaskInput.value.trim();
                if (!taskName) {
                    alert('Por favor, introduce una tarea.');
                    return;
                }

                const li = document.createElement('li');
                li.textContent = taskName;
                li.dataset.id = task.id || Date.now();
                if (task.completed) li.classList.add('completed');

                const completeBtn = document.createElement('button');
                completeBtn.textContent = 'DONE';
                completeBtn.title = 'Marcar como completado';
                completeBtn.classList.add('complete-btn');

                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'ERASE';
                deleteBtn.title = 'Eliminar tarea';
                deleteBtn.classList.add('delete-btn');

                li.appendChild(completeBtn);
                li.appendChild(deleteBtn);
                elements.taskList.appendChild(li);

                if (!task.id) {
                    saveTask({ id: li.dataset.id, name: taskName, completed: false });
                    elements.newTaskInput.value = '';
                }
            }

            function saveTask(task) {
                const tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
                tasks.push(task);
                localStorage.setItem('tasks', JSON.stringify(tasks));
            }

            function saveAllTasks() {
                const tasks = Array.from(elements.taskList.children).map(li => ({
                    id: li.dataset.id,
                    name: li.firstChild.textContent.trim(),
                    completed: li.classList.contains('completed')
                }));
                localStorage.setItem('tasks', JSON.stringify(tasks));
            }

            function deleteTask(id) {
                let tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
                tasks = tasks.filter(task => task.id !== id);
                localStorage.setItem('tasks', JSON.stringify(tasks));
            }

            function loadData() {
                completedWorkSessions = parseInt(localStorage.getItem('completedWorkSessions'), 10) || 0;
                elements.sessionCounter.textContent = `Sesiones completadas: ${completedWorkSessions}`;

                const tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
                tasks.forEach(addTask);

                loadDurations();

                const timerState = JSON.parse(localStorage.getItem('timerState') || 'null');
                if (timerState) {
                    endTime = timerState.endTime;
                    currentSession = timerState.currentSession;
                    completedWorkSessions = timerState.completedWorkSessions || 0;
                    shortBreaksCompleted = timerState.shortBreaksCompleted || 0; 
                    elements.sessionIndicatorText.textContent = `Tipo de Sesión: ${capitalizeFirstLetter(currentSession)}`;
                    timerDuration = getDurationBySession(currentSession);
                    const now = Date.now();
                    timerRemaining = Math.floor((endTime - now) / 1000);

                    if (timerRemaining > 0) {
                        elements.timerDisplay.textContent = formatTime(timerRemaining);
                        elements.progressContainer.style.display = 'block';
                        updateProgress();
                        startTimer(false);
                    } else {
                        handleSessionEnd();
                    }
                }

                isMusicMuted = JSON.parse(localStorage.getItem('isMusicMuted')) || false;
                elements.backgroundMusic.muted = isMusicMuted;
                updateMusicIcon();

                const isAutoStartEnabled = JSON.parse(localStorage.getItem('isAutoStartEnabled'));
                elements.autoStartCheckbox.checked = isAutoStartEnabled || false;
            }

            function updateMusicIcon() {
                elements.musicIcon.src = isMusicMuted
                    ? "https://img.icons8.com/ios-filled/50/ffffff/mute.png"
                    : "https://img.icons8.com/ios-filled/50/ffffff/speaker.png";
            }

            function toggleMusic() {
                isMusicMuted = !isMusicMuted;
                elements.backgroundMusic.muted = isMusicMuted;
                localStorage.setItem('isMusicMuted', isMusicMuted);
                updateMusicIcon();
                if (currentSession === 'work') {
                    if (isMusicMuted) {
                        pauseMusic();
                    } else {
                        playMusic();
                    }
                }
                changePalette();
            }

            elements.startPauseBtn.addEventListener('click', () => {
                if (isRunning) {
                    pauseTimer();
                } else {
                    startTimer();
                    changePalette();
                }
            });

            elements.resetBtn.addEventListener('click', () => {
                resetTimer();
                changePalette();
            });

            elements.skipBtn.addEventListener('click', () => {
                skipSession();
                changePalette();
            });

            elements.saveDurationsBtn.addEventListener('click', saveDurations);

            elements.addTaskBtn.addEventListener('click', () => {
                addTask();
                changePalette();
                saveAllTasks();
            });

            elements.newTaskInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    addTask();
                    changePalette();
                    saveAllTasks();
                }
            });

            elements.taskList.addEventListener('click', (e) => {
                const li = e.target.closest('li');
                if (!li) return;
                const id = li.dataset.id;

                if (e.target.classList.contains('complete-btn')) {
                    li.classList.toggle('completed');
                    saveAllTasks();
                }

                if (e.target.classList.contains('delete-btn')) {
                    li.remove();
                    deleteTask(id);
                }
            });

            elements.musicControl.addEventListener('click', toggleMusic);

            document.addEventListener('mousemove', (e) => {
                elements.customCursor.style.left = `${e.clientX}px`;
                elements.customCursor.style.top = `${e.clientY}px`;
            });

            document.querySelectorAll('.interactive').forEach(elem => {
                elem.addEventListener('mouseenter', () => {
                    elements.customCursor.style.transform = 'translate(-50%, -50%) scale(1.5)';
                    elements.customCursor.style.backgroundColor = '#ff6600';
                    elements.customCursor.style.borderColor = '#ff6600';
                });

                elem.addEventListener('mouseleave', () => {
                    elements.customCursor.style.transform = 'translate(-50%, -50%) scale(1)';
                    elements.customCursor.style.backgroundColor = getComputedStyle(elements.root).getPropertyValue('--cursor-color');
                    elements.customCursor.style.borderColor = getComputedStyle(elements.root).getPropertyValue('--primary-color');
                });
            });

            // Guardar el estado de auto inicio al cambiar la checkbox
            elements.autoStartCheckbox.addEventListener('change', () => {
                localStorage.setItem('isAutoStartEnabled', elements.autoStartCheckbox.checked);
            });

            if ('Notification' in window && Notification.permission !== 'granted' && Notification.permission !== 'denied') {
                Notification.requestPermission();
            }

            loadData();

            elements.toggleDurationsBtn.addEventListener('click', () => {
                elements.dropdownContent.classList.toggle('open');
                elements.toggleDurationsBtn.classList.toggle('active');
            });
        });
    </script>
</body>
</html>
